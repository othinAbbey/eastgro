generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  
}

model Product {
  id                  String            @id @default(uuid())
  name                String
  price               Int
  quantity            Int
  createdAt           DateTime          @default(now())
  transporterId       String?
  unit                String            @default("Kgs")
  marketListings      MarketListing[]
  transporter         Transporter?      @relation(fields: [transporterId], references: [id])
  TraceabilityLog     TraceabilityLog[]
  Processing_Facility Facility[]        @relation("FacilityProducts")
  farmer              Farmer[]          @relation("FarmerProducts")
  produce             Produce[]         @relation("ProduceProducts")
  QR_code             QRCode[]          @relation("QRCodeProducts")
  shipment            Shipment[]        @relation("ShipmentProducts")
  transactions        Transaction[]     @relation("TransactionProducts")
}

model MarketListing {
  id          String   @id @default(uuid())
  productId   String
  sellerId    String
  sellerType  String
  price       Int
  quantity    Int
  location    String
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  product     Product  @relation(fields: [productId], references: [id])
}

model Produce {
  id              String            @id @default(uuid())
  farmerId        String?
  type            String
  region          String            @default("Eastern")
  quantity        Int
  harvestDate     DateTime
  qualityReport   QualityGrade?
  status          ProduceStatus     @default(HARVESTED)
  isBiofortified  Boolean           @default(false)
  createdAt       DateTime          @default(now())
  price           Int               @default(0)
  unit            String            @default("kgs")
  farmer          Farmer?           @relation(fields: [farmerId], references: [id])
  qrCode          QRCode?
  shipments       Shipment[]
  storage         Storage?
  TraceabilityLog TraceabilityLog[]
  loadAtFacility  loadAtFacility[]
  facilities      Facility[]        @relation("ProduceFacilities")
  products        Product[]         @relation("ProduceProducts")
  transactions    Transaction[]     @relation("TransactionProduce")
}

model Storage {
  id         String     @id @default(uuid())
  facilityId String
  produceId  String     @unique
  quantity   Int
  storedAt   DateTime   @default(now())
  shipments  Shipment[]
  facility   Facility   @relation(fields: [facilityId], references: [id])
  produce    Produce    @relation(fields: [produceId], references: [id])
}

model loadAtFacility {
  id         String     @id @default(uuid())
  facilityId String
  produceId  String
  quantity   Int
  loadedAt   DateTime   @default(now())
  facility   Facility   @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  produce    Produce    @relation(fields: [produceId], references: [id])
  shipments  Shipment[] @relation("ShipmentToloadAtFacility")
}

model QRCode {
  id          String    @id @default(uuid())
  produceId   String    @unique
  generatedAt DateTime  @default(now())
  scannedAt   DateTime?
  produce     Produce   @relation(fields: [produceId], references: [id])
  products    Product[] @relation("QRCodeProducts")
}

model Shipment {
  id             String           @id @default(uuid())
  produceId      String
  transporterId  String?
  facilityId     String?
  storageId      String?
  destination    String
  status         ShipmentStatus   @default(PENDING)
  deliveryDate   DateTime?
  facility       Facility?        @relation(fields: [facilityId], references: [id])
  produce        Produce          @relation(fields: [produceId], references: [id])
  storage        Storage?         @relation(fields: [storageId], references: [id])
  transporter    Transporter?     @relation(fields: [transporterId], references: [id])
  products       Product[]        @relation("ShipmentProducts")
  loadAtFacility loadAtFacility[] @relation("ShipmentToloadAtFacility")
}

model Transporter {
  id             String     @id @default(uuid())
  name           String
  vehicleDetails String?
  contact        String
  status         String
  Region         String
  products       Product[]
  shipments      Shipment[]
}

model Facility {
  id                String           @id @default(uuid())
  name              String
  location          String
  processingDetails String?
  workload          Int              @default(0)
  shipments         Shipment[]
  storage           Storage[]
  loads             loadAtFacility[]
  products          Product[]        @relation("FacilityProducts")
  producesHandled   Produce[]        @relation("ProduceFacilities")
}

model Farmer {
  id          String     @id @default(uuid())
  name        String
  contact     String     @unique
  location    String
  password    String
  farmDetails String?
  groupId     String?
  FarmPlan    FarmPlan[]
  group       Group?     @relation("GroupFarmers", fields: [groupId], references: [id])
  problems    Problem[]
  produce     Produce[]
  Report      Report[]
  Weather     Weather[]
  products    Product[]  @relation("FarmerProducts")
}

model Customer {
  id              String        @id @default(uuid())
  name            String
  password        String
  contact         String        @unique
  purchaseHistory String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  transactions    Transaction[]
}

model Group {
  id            String   @id @default(uuid())
  cropType      String
  totalQuantity Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  region        String
  farmers       Farmer[] @relation("GroupFarmers")
}

model Problem {
  id       String            @id @default(uuid())
  farmtype String
  farmerId String
  Crop     String
  Disease  String
  Pest     String
  reportId String?
  farmer   Farmer            @relation(fields: [farmerId], references: [id])
  report   Report?           @relation(fields: [reportId], references: [id])
  progress ProblemProgress[]
}

model ProblemProgress {
  id        String        @id @default(uuid())
  problemId String
  update    String
  updatedBy String
  status    ProblemStatus @default(REPORTED)
  updatedAt DateTime      @default(now())
  problem   Problem       @relation(fields: [problemId], references: [id])
}

model Report {
  id        String    @id @default(uuid())
  endDate   String
  farmerId  String
  startDate String
  problems  Problem[]
  farmer    Farmer    @relation(fields: [farmerId], references: [id])
}

model FarmInput {
  id           String        @id @default(uuid())
  name         String
  type         String
  quantity     Int
  unit         String
  createdAt    DateTime      @default(now())
  price        Int           @default(0)
  transactions Transaction[] @relation("TransactionInputs")
}

model User {
  id         String       @id @default(cuid())
  name       String
  email      String       @unique
  contact    String       @unique
  password   String
  userRole   UserRole
  location   String?
  district   String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  Investment Investment[]

  @@map("users")
}

model TraceabilityLog {
  id         String          @id @default(uuid())
  actionType TraceActionType
  productId  String
  timestamp  DateTime        @default(now())
  produceId  String?
  produce    Produce?        @relation(fields: [produceId], references: [id])
  product    Product         @relation(fields: [productId], references: [id])
}

model ServiceProvider {
  id              String             @id @default(uuid())
  name            String
  contact         String             @unique
  email           String             @unique
  password        String
  businessName    String
  description     String?
  location        String
  region          String             @default("Eastern")
  rating          Float?             @default(0.0)
  isVerified      Boolean            @default(false)
  createdAt       DateTime           @default(now())
  availability    String             @default("Monday-Friday, 8AM-5PM")
  equipment       String[]
  minOrderAmount  Float?
  profileImage    String?
  qualifications  String[]
  travelRadius    Int?
  role            UserRole           @default(EXPERT)
  servicesOffered ServiceOfferings[]
  transactions    Transaction[]      @relation("ServiceProviderTransactions")
}

model ServiceOfferings {
  id                String          @id @default(uuid())
  serviceId         String
  serviceProviderId String
  rate              Float
  minQuantity       Int?            @default(1)
  unit              String          @default("session")
  notes             String?
  isActive          Boolean         @default(true)
  service           Service         @relation(fields: [serviceId], references: [id])
  serviceProvider   ServiceProvider @relation(fields: [serviceProviderId], references: [id])
  Transaction       Transaction[]   @relation("ServiceOfferingsToTransaction")
}

model Service {
  id           String             @id @default(uuid())
  description  String
  name         String
  basePrice    Float
  category     String
  createdAt    DateTime           @default(now())
  isActive     Boolean            @default(true)
  updatedAt    DateTime           @updatedAt
  providers    ServiceOfferings[]
  transactions Transaction[]      @relation("TransactionServices")
}

model Transaction {
  id                String             @id @default(uuid())
  buyerId           String
  totalAmount       Int
  status            String             @default("PENDING")
  paymentMethod     String             @default("CASH")
  serviceProviderId String?
  buyer             Customer           @relation(fields: [buyerId], references: [id])
  serviceProvider   ServiceProvider?   @relation("ServiceProviderTransactions", fields: [serviceProviderId], references: [id])
  serviceOfferings  ServiceOfferings[] @relation("ServiceOfferingsToTransaction")
  FarmInput         FarmInput[]        @relation("TransactionInputs")
  produce           Produce[]          @relation("TransactionProduce")
  products          Product[]          @relation("TransactionProducts")
  services          Service[]          @relation("TransactionServices")
}

model Crop {
  id           String         @id @default(uuid())
  name         String         @unique
  description  String
  agronomy     Agronomy[]
  CostTemplate CostTemplate[]
  inputs       CropInput[]
  CropVariety  CropVariety[]
  diseases     Disease[]
  pests        Pest[]
}

model Agronomy {
  id      String @id @default(uuid())
  content String
  cropId  String
  crop    Crop   @relation(fields: [cropId], references: [id])
}

model CropInput {
  id          String @id @default(uuid())
  name        String
  type        String
  description String
  cropId      String
  crop        Crop   @relation(fields: [cropId], references: [id])
}

model Pest {
  id          String  @id @default(uuid())
  name        String
  description String
  control     String?
  cropId      String
  crop        Crop    @relation(fields: [cropId], references: [id])
}

model Disease {
  id          String  @id @default(uuid())
  name        String
  description String
  treatment   String?
  cropId      String
  crop        Crop    @relation(fields: [cropId], references: [id])
}

model CropVariety {
  id               String     @id @default(uuid())
  cropId           String
  yieldPotential   String
  daysToMaturity   Int
  description      String
  name             String
  yieldPerAcre     String
  kgPerAcre        Int
  marketPricePerKg Float?
  crop             Crop       @relation(fields: [cropId], references: [id])
  FarmPlan         FarmPlan[]
}

model FarmPlan {
  id               String         @id @default(uuid())
  name             String
  plantingDate     DateTime
  gardenSize       Float
  farmerId         String
  varietyId        String
  estimatedYield   Float?
  estimatedRevenue Float?
  estimatedProfit  Float?
  costs            Cost[]
  activities       FarmActivity[]
  farmer           Farmer         @relation(fields: [farmerId], references: [id])
  variety          CropVariety    @relation(fields: [varietyId], references: [id])
  records          FarmRecord[]
}

model CostTemplate {
  id          String   @id @default(uuid())
  type        CostType
  stage       Stage
  amount      Float
  cropId      String
  description String?
  isRequired  Boolean  @default(true)
  crop        Crop     @relation(fields: [cropId], references: [id])
}

model Cost {
  id          String   @id @default(uuid())
  farmPlanId  String
  type        CostType
  stage       Stage
  description String?
  amount      Float
  isCustom    Boolean  @default(false)
  farmPlan    FarmPlan @relation(fields: [farmPlanId], references: [id])
}

model FarmActivity {
  id          String   @id @default(uuid())
  farmPlanId  String
  title       String
  description String?
  photoUrl    String?
  timestamp   DateTime @default(now())
  farmPlan    FarmPlan @relation(fields: [farmPlanId], references: [id])
}

model FarmRecord {
  id         String   @id @default(uuid())
  farmPlanId String
  type       String
  details    String
  createdAt  DateTime @default(now())
  farmPlan   FarmPlan @relation(fields: [farmPlanId], references: [id])
}

model Weather {
  id          Int      @id @default(autoincrement())
  farmerId    String?
  location    String
  temperature Float
  humidity    Float
  windSpeed   Float
  conditions  String
  description String
  icon        String
  timestamp   DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  Farmer      Farmer?  @relation(fields: [farmerId], references: [id])
}

model Investment {
  id                String                  @id @default(uuid())
  investorId        String
  initialAmount     Float
  currentBalance    Float
  monthlyReturnRate Float                   @default(7.1)
  totalEarned       Float                   @default(0)
  status            InvestmentStatus        @default(ACTIVE)
  startDate         DateTime                @default(now())
  endDate           DateTime?
  nextPayoutDate    DateTime
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  investor          User                    @relation(fields: [investorId], references: [id])
  inventory         InvestmentInventory[]
  transactions      InvestmentTransaction[]
  payouts           Payout[]
}

model Payout {
  id            String       @id @default(uuid())
  investmentId  String
  amount        Float
  status        PayoutStatus @default(PENDING)
  scheduledDate DateTime
  paidDate      DateTime?
  createdAt     DateTime     @default(now())
  investment    Investment   @relation(fields: [investmentId], references: [id])
}

model InvestmentTransaction {
  id           String     @id @default(uuid())
  investmentId String
  type         String
  amount       Float
  description  String
  status       String     @default("completed")
  date         DateTime   @default(now())
  investment   Investment @relation(fields: [investmentId], references: [id])
}

model InvestmentInventory {
  id                 String           @id @default(uuid())
  investmentId       String
  productType        String           @default("Rice")
  totalPurchased     Int
  sold               Int              @default(0)
  remaining          Int
  averageBuyPrice    Float
  currentMarketPrice Float
  currentValue       Float
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  investment         Investment       @relation(fields: [investmentId], references: [id])
  sales              InvestmentSale[]
}

model InvestmentSale {
  id           String              @id @default(uuid())
  inventoryId  String
  date         DateTime            @default(now())
  quantity     Int
  pricePerUnit Float
  totalAmount  Float
  buyer        String
  inventory    InvestmentInventory @relation(fields: [inventoryId], references: [id])
}

/// ----------Organised------------------
enum ProduceStatus {
  HARVESTED
  IN_TRANSIT
  PROCESSED
  DELIVERED
}

enum ShipmentStatus {
  PENDING
  IN_TRANSIT
  DELIVERED
  RETURNED
}

enum QualityGrade {
  A
  B
  C
  D
  FAILED
}

enum ProblemStatus {
  REPORTED
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum UserRole {
  ADMIN
  FARMER
  CUSTOMER
  SOLETRADER
  PASSIVETRADER
  GUEST
  EXPERT
}

enum TraceActionType {
  HARVESTED
  LOADED
  TRANSPORTED
  STORED
  DELIVERED
  SOLD
}

enum CostType {
  ONE_TIME
  SEASONAL
  INVESTMENTCOSTS
}

enum Stage {
  LAND_PREPARATION
  PLANTING
  MANAGEMENT
  HARVEST
  POST_HARVEST
  MARKETING
}

enum InvestmentStatus {
  ACTIVE
  COMPLETED
  CANCELLED
  PENDING
}

enum PayoutStatus {
  PENDING
  PAID
  FAILED
  PROCESSING
}
